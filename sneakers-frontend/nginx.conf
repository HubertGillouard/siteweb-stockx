# sneakers-frontend/nginx.conf
server {
  listen 80;
  server_name _;

  # Sert les fichiers build de Vite copiés dans /usr/share/nginx/html
  root /usr/share/nginx/html;
  index index.html;

  # Proxy de toutes les routes /api/* vers le conteneur API
  # ⚠️ IMPORTANT : PAS de slash final dans proxy_pass, sinon /api est supprimé !
  location /api/ {
    proxy_pass http://api:5050;
    proxy_http_version 1.1;

    proxy_set_header Host              $host;
    proxy_set_header X-Real-IP         $remote_addr;
    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # Optionnel (utile si SSE/websockets plus tard)
    proxy_set_header Connection "";
  }

  # (Optionnel) un /health côté Nginx lui-même (pas l'API)
  # Tu peux l’enlever si tu ne t’en sers pas.
  location = /health {
    add_header Content-Type application/json;
    return 200 '{"ok":true}';
  }

  # SPA fallback : toutes les routes front retombent sur index.html
  location / {
    try_files $uri /index.html;
  }
}
